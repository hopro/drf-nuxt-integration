import{a as oe,c as x,_ as re}from"./CKdEhTHU.js";import{P as ie,K as se,Q as ue,L as ce,_ as U,G as y,aY as q,r as v,m as de,R as me,aZ as fe,b as l,S as P,aJ as pe,F as B,q as ve,a_ as ye,x as he,k as be,c as ge,w as h,o as R,z as M,B as p,a9 as ke,d as Ve,aB as Ce,I as _e}from"./Bh59aRpc.js";import{u as Ie}from"./DHrnonhk.js";import{V as Fe,a as Z}from"./a5OFAv6S.js";import{V as Se,b as Ae}from"./cefNi3wq.js";import{V as we,a as ze}from"./DNJGKzx0.js";import{u as De,a as j,f as xe,m as Pe,b as Be,c as Re,d as Ee}from"./jyi1f3K3.js";import"./B9i1-_oj.js";import"./B4cRk-tp.js";import"./BvlIk6eM.js";/* empty css        */const $e=se({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},...Be({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>U(e).every(m=>m!=null&&typeof m=="object")},...Pe({clearable:!0})},"VFileInput"),Ne=ie()({name:"VFileInput",inheritAttrs:!1,props:$e(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,m){let{attrs:b,emit:d,slots:r}=m;const{t:k}=ue(),i=ce(e,"modelValue",e.modelValue,a=>U(a),a=>!e.multiple&&Array.isArray(a)?a[0]:a),{isFocused:g,focus:w,blur:c}=De(e),I=y(()=>typeof e.showSize!="boolean"?e.showSize:void 0),F=y(()=>(i.value??[]).reduce((a,o)=>{let{size:C=0}=o;return a+C},0)),S=y(()=>q(F.value,I.value)),V=y(()=>(i.value??[]).map(a=>{const{name:o="",size:C=0}=a;return e.showSize?`${o} (${q(C,I.value)})`:o})),s=y(()=>{var o;const a=((o=i.value)==null?void 0:o.length)??0;return e.showSize?k(e.counterSizeString,a,S.value):k(e.counterString,a)}),u=v(),n=v(),t=v(),L=y(()=>g.value||e.active),E=y(()=>["plain","underlined"].includes(e.variant));function z(){var a;t.value!==document.activeElement&&((a=t.value)==null||a.focus()),g.value||w()}function O(a){var o;(o=t.value)==null||o.click()}function G(a){d("mousedown:control",a)}function J(a){var o;(o=t.value)==null||o.click(),d("click:control",a)}function K(a){a.stopPropagation(),z(),ve(()=>{i.value=[],ye(e["onClick:clear"],a)})}function Q(a){a.preventDefault()}function W(a){a.preventDefault(),a.dataTransfer&&(i.value=[...a.dataTransfer.files??[]])}return de(i,a=>{(!Array.isArray(a)||!a.length)&&t.value&&(t.value.value="")}),me(()=>{const a=!!(r.counter||e.counter),o=!!(a||r.details),[C,Y]=fe(b),{modelValue:Te,...H}=j.filterProps(e),X=xe(e);return l(j,P({ref:u,modelValue:e.multiple?i.value:i.value[0],class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":E.value},e.class],style:e.style,"onClick:prepend":O},C,H,{centerAffix:!E.value,focused:g.value}),{...r,default:D=>{let{id:A,isDisabled:_,isDirty:$,isReadonly:N,isValid:ee}=D;return l(Ee,P({ref:n,"prepend-icon":e.prependIcon,onMousedown:G,onClick:J,"onClick:clear":K,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},X,{id:A.value,active:L.value||$.value,dirty:$.value||e.dirty,disabled:_.value,focused:g.value,error:ee.value===!1,onDragover:Q,onDrop:W}),{...r,default:ae=>{var T;let{props:{class:te,...le}}=ae;return l(B,null,[l("input",P({ref:t,type:"file",readonly:N.value,disabled:_.value,multiple:e.multiple,name:e.name,onClick:f=>{f.stopPropagation(),N.value&&f.preventDefault(),z()},onChange:f=>{if(!f.target)return;const ne=f.target;i.value=[...ne.files??[]]},onFocus:z,onBlur:c},le,Y),null),l("div",{class:te},[!!((T=i.value)!=null&&T.length)&&!e.hideInput&&(r.selection?r.selection({fileNames:V.value,totalBytes:F.value,totalBytesReadable:S.value}):e.chips?V.value.map(f=>l(oe,{key:f,size:"small",text:f},null)):V.value.join(", "))])])}})},details:o?D=>{var A,_;return l(B,null,[(A=r.details)==null?void 0:A.call(r,D),a&&l(B,null,[l("span",null,null),l(Re,{active:!!((_=i.value)!=null&&_.length),value:s.value,disabled:e.disabled},r.counter)])])}:void 0})}),pe({},u,n,t)}}),We={__name:"profile",setup(e){const m=he(),{showNotification:b}=_e(),d=v(!1),r=v(""),k=v({}),i=v(null),{handleApiErrors:g,resetErrors:w}=Ie({error:r,fieldErrors:k}),c=v({username:"",email:"",bith_date:"",mobile_phone:"",avatar:null,address:"",comment:""}),I=[{key:"username",label:"Имя пользователя",type:"text",required:!0,readonly:!0,cols:12,sm:6,md:6,prepend:"mdi-account",validation:x().required("Имя пользователя обязательно").min(3,"Минимум 3 символа").max(150,"Максимум 150 символов")},{key:"email",label:"Email",type:"text",required:!0,cols:12,sm:6,md:6,prepend:"mdi-email",validation:x().required("Email обязателен").matches(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,"Введите корректный email")},{key:"bith_date",label:"Дата рождения",type:"date",cols:12,sm:6,md:6,prepend:"mdi-calendar"},{key:"mobile_phone",label:"Мобильный телефон",type:"phone",prepend:"mdi-phone",cols:12,sm:6,md:6,validation:x().required("Телефон обязателен").matches(/^\+7\s?\(\d{3}\)\s?\d{3}[-\s]?\d{2}[-\s]?\d{2}$/,"Введите корректный номер телефона")},{key:"address",label:"Адрес",type:"text",cols:12,sm:12,md:12,prepend:"mdi-map-marker"},{key:"comment",label:"Комментарий",type:"textarea",cols:12,sm:12,md:12,prepend:"mdi-comment"}],F=async()=>{d.value=!0;try{const s=await m.getWithString("accounts/users/me/");c.value=s}catch{r.value="Ошибка при загрузке профиля"}finally{d.value=!1}},S=async s=>{if(!s)return;const u=new FormData;for(const n in c.value)if(c.value[n]!==null&&c.value[n]!==void 0){if(n==="avatar"&&typeof c.value.avatar=="string")continue;u.append(n,c.value[n])}u.append("avatar",s);try{const n=await m.putFormData("accounts/users/me/",u);c.value.avatar=n.avatar,b({message:"Аватар успешно обновлен",type:"success"})}catch{b({message:"Ошибка при загрузке аватара",type:"error"})}},V=async s=>{var n;d.value=!0,w();const u=new FormData;for(const t in s)s[t]===null||s[t]===void 0||t==="avatar"&&typeof s.avatar=="string"||u.append(t,s[t]);try{await m.putFormData("accounts/users/me/",u),b({message:"Профиль успешно обновлен",type:"success"})}catch(t){b({message:"Произошла ошибка при обновлении профиля",type:"error"}),(n=t.response)!=null&&n.data?g(t.response.data):r.value="Произошла ошибка при обновлении профиля"}finally{d.value=!1}};return be(()=>{F()}),(s,u)=>{const n=re;return R(),ge("div",null,[l(Fe,null,{default:h(()=>[l(Z,{cols:"12",md:"4"},{default:h(()=>[l(Se,null,{default:h(()=>[l(Ae,{class:"text-center"},{default:h(()=>[l(we,{size:"150",class:"mb-4"},{default:h(()=>[p(c).avatar?(R(),M(ze,{key:0,src:p(c).avatar,alt:"User Avatar"},null,8,["src"])):(R(),M(ke,{key:1,size:"150",color:"grey-lighten-1"},{default:h(()=>u[1]||(u[1]=[Ve("mdi-account-circle")])),_:1}))]),_:1}),l(Ne,{modelValue:p(i),"onUpdate:modelValue":[u[0]||(u[0]=t=>Ce(i)?i.value=t:null),S],accept:"image/*",label:"Изменить аватар","prepend-icon":"mdi-camera",variant:"outlined",density:"comfortable","hide-details":"",class:"mb-4"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(Z,{cols:"12",md:"8"},{default:h(()=>[l(n,{title:"Профиль пользователя",fields:I,"initial-data":p(c),loading:p(d),error:p(r),"field-errors":p(k),"submit-button-text":p(d)?"Сохранение...":"Сохранить",onSubmit:V},null,8,["initial-data","loading","error","field-errors","submit-button-text"])]),_:1})]),_:1})])}}};export{We as default};
