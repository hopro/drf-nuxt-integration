import{c as y,_ as B}from"./CKdEhTHU.js";import{g as R,E as S,H as A,x as M,r as i,G as W,k as P,c as O,o as v,b as x,w as m,d as k,B as h,V as f,z as w,A as $,I as T}from"./Bh59aRpc.js";import{u as z}from"./DHrnonhk.js";import"./jyi1f3K3.js";import"./B4cRk-tp.js";import"./DNJGKzx0.js";import"./B9i1-_oj.js";import"./cefNi3wq.js";import"./BvlIk6eM.js";/* empty css        */import"./a5OFAv6S.js";const Z=R({__name:"[id]",setup(G){const d=S(),p=A(),n=M(),b=i({}),u=i({uchastok_name:"",uchastok_code:"",name:"",surname:"",patronymic:"",date_of_birth:null,date_of_death:null,age:0,address:"",phone:"",snils:"",MO_prikrepl:"",lgota:"",category:"",ychastok:null}),o=i(!1),r=i(""),a=i(!0),C=i([]),{handleApiErrors:q,resetErrors:_}=z({error:r,fieldErrors:b}),{showNotification:c}=T(),l=W(()=>d.params.id==="create"),E=[{key:"surname",label:"Фамилия",type:"text",cols:12,required:!0,sm:6,md:4},{key:"name",label:"Имя",type:"text",cols:12,required:!0,sm:6,md:4},{key:"patronymic",label:"Отчество",type:"text",cols:12,sm:6,md:4},{key:"date_of_birth",label:"Дата рождения",type:"date",cols:12,required:!0,sm:6,md:4},{key:"date_of_death",label:"Дата смерти",type:"date",cols:12,sm:6,md:4,validation:y().nullable().notRequired()},{key:"age",label:"Возраст",type:"number",cols:12,sm:6,md:4},{key:"address",label:"Адрес",type:"text",cols:12,sm:12,md:8},{key:"phone",label:"Телефон",type:"phone",cols:12,sm:6,md:4,validation:y().nullable().notRequired()},{key:"snils",label:"СНИЛС",type:"text",cols:12,sm:6,md:4},{key:"MO_prikrepl",label:"МО прикрепления",type:"text",cols:12,sm:6,md:4},{key:"lgota",label:"Льгота",type:"text",cols:12,sm:6,md:4},{key:"category",label:"Категория",type:"select",cols:12,sm:6,md:4,items:[{value:"Пенсионер",display_name:"Пенсионер"},{value:"Работающий",display_name:"Работающий"},{value:"Студент",display_name:"Студент"},{value:"Школьник",display_name:"Школьник"},{value:"Инвалид",display_name:"Инвалид"},{value:"Все записи",display_name:""}]},{key:"ychastok",label:"Участок",type:"autocomplete",cols:12,sm:6,md:4,endpoint:"gp4_analitika/uchastki/",itemTitle:"name",itemValue:"id",validation:y().nullable().notRequired()},{key:"uchastok_name",label:"Название участка",type:"text",cols:12,sm:6,md:4},{key:"uchastok_code",label:"Код участка",type:"text",cols:12,sm:6,md:4}];P(async()=>{l.value?a.value=!1:await g(),await N()});async function g(){o.value=!0,_();try{const t=await n.getWithString(`gp4_analitika/patients/${d.params.id}/`);u.value=t}catch(t){r.value="Ошибка при загрузке данных пациента",console.error(t)}finally{o.value=!1}}async function N(){try{const t=await n.getWithString("gp4_analitika/uchastki/");C.value=t.results||[]}catch(t){console.error("Ошибка при загрузке участков:",t)}}async function V(t){var e;o.value=!0,r.value="",_();try{l.value?(await n.postWithString("gp4_analitika/patients/",t),c({message:"Пациент добавлен!",type:"success"}),p.push("/patients")):(await n.putWithString(`gp4_analitika/patients/${d.params.id}/`,t),a.value=!0,c({message:"Данные по пациенту обновлены!",type:"success"}),await g())}catch(s){(e=s.response)!=null&&e.data?q(s.response.data):r.value="Произошла ошибка. Попробуйте позже.",c({message:"Ошибка сохранения данных",type:"error"})}finally{o.value=!1}}return(t,e)=>(v(),O("div",null,[x(f,{class:"mb-4","prepend-icon":"mdi-arrow-left",variant:"text",onClick:e[0]||(e[0]=s=>h(p).back())},{default:m(()=>e[4]||(e[4]=[k(" Назад к списку ")])),_:1}),x(B,{title:l.value?"Добавление пациента":`Пациент: ${u.value.surname} ${u.value.name}`,fields:E,"initial-data":u.value,loading:o.value,error:r.value,"field-errors":b.value,readonly:a.value,"submit-button-text":l.value?"Создать":"Сохранить",onSubmit:V,onCancel:e[3]||(e[3]=s=>h(p).back())},{"title-actions":m(()=>[!l.value&&a.value?(v(),w(f,{key:0,color:"primary",variant:"text","prepend-icon":"mdi-pencil",onClick:e[1]||(e[1]=s=>a.value=!1)},{default:m(()=>e[5]||(e[5]=[k(" Редактировать ")])),_:1})):$("",!0),!l.value&&!a.value?(v(),w(f,{key:1,color:"grey",variant:"text","prepend-icon":"mdi-eye",onClick:e[2]||(e[2]=s=>a.value=!0)},{default:m(()=>e[6]||(e[6]=[k(" Просмотр ")])),_:1})):$("",!0)]),_:1},8,["title","initial-data","loading","error","field-errors","readonly","submit-button-text"])]))}});export{Z as default};
